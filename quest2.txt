En faite, j'ai deja fait :"
cols_to_drop = ['Satisfaction Score', 'RowNumber', 'Surname', 'Point Earned']

train_train_df = train_train_df.drop(columns=cols_to_drop)

test_train_df = test_train_df.drop(columns=cols_to_drop)
", "from sklearn.model_selection import train_test_split

# Separate features and label
X = train_df.drop('Exited', axis=1)
y = train_df['Exited']

# Split train / validation (80% / 20%)
X_train, X_val, y_train, y_val = train_test_split(
    X, y,
    test_size=0.2,
    stratify=y,
    random_state=42
)

print("X_train :", X_train.shape, "y_train :", y_train.shape)
print("X_val   :", X_val.shape, "y_val   :", y_val.shape)
print("test_df :", test_df.shape)  

print(y_train.head())
", "from sklearn.preprocessing import OneHotEncoder
import pandas as pd

# Colonnes catégoriques à encoder
cat_cols = ['Geography', 'Gender', 'Card Type']

# Créer l'encodeur avec la syntaxe compatible
encoder = OneHotEncoder(handle_unknown='ignore', sparse_output=False)

# Fit sur le train
encoder.fit(X_train[cat_cols])

# Transformer train, validation et test
X_train_encoded = encoder.transform(X_train[cat_cols])
X_val_encoded   = encoder.transform(X_val[cat_cols])
X_test_encoded  = encoder.transform(test_df[cat_cols])

# Convertir en DataFrame avec noms de colonnes
encoded_cols = encoder.get_feature_names_out(cat_cols)
X_train_encoded = pd.DataFrame(X_train_encoded, columns=encoded_cols, index=X_train.index)
X_val_encoded   = pd.DataFrame(X_val_encoded, columns=encoded_cols, index=X_val.index)
X_test_encoded  = pd.DataFrame(X_test_encoded, columns=encoded_cols, index=test_df.index)

# Supprimer les colonnes catégoriques originales et concaténer les colonnes encodées
X_train = pd.concat([X_train.drop(columns=cat_cols), X_train_encoded], axis=1)
X_val   = pd.concat([X_val.drop(columns=cat_cols), X_val_encoded], axis=1)
X_test  = pd.concat([test_df.drop(columns=cat_cols), X_test_encoded], axis=1)

# Vérification finale
print("X_train columns :", X_train.columns)
print("X_val columns   :", X_val.columns)
print("X_test columns  :", X_test.columns)
", "# Suppression de la colonne fortement corrélée
X_train_nocomp = X_train.drop(columns=['Complain'])
X_val_nocomp = X_val.drop(columns=['Complain'])
test_df_nocomp = test_df.drop(columns=['Complain'])"




# --- 1️⃣ Tranches d'âge ---
train_df['AgeGroup'] = pd.cut(
    train_df['Age'],
    bins=[18, 30, 40, 50, 100],
    labels=['Young','Stable','AtRisk','Senior']
)

X_val_nocomp['AgeGroup'] = pd.cut(
    X_val_nocomp['Age'],
    bins=[18, 30, 40, 50, 100],
    labels=['Young','Stable','AtRisk','Senior']
)

# --- 2️⃣ Flag produit faible ---
train_df['LowProducts'] = (train_df['NumOfProducts'] == 1).astype(int)
X_val_nocomp['LowProducts'] = (X_val_nocomp['NumOfProducts'] == 1).astype(int)

# --- 3️⃣ Interaction Age x NumOfProducts ---
train_df['Age_Products'] = train_df['Age'] * train_df['NumOfProducts']
X_val_nocomp['Age_Products'] = X_val_nocomp['Age'] * X_val_nocomp['NumOfProducts']

# --- Vérification rapide ---
print("✅ Aperçu des nouvelles features sur le train :")
print(train_df[['Age', 'NumOfProducts', 'AgeGroup', 'LowProducts', 'Age_Products']].head())

print("\n✅ Aperçu des nouvelles features sur la validation :")
print(X_val_nocomp[['Age', 'NumOfProducts', 'AgeGroup', 'LowProducts', 'Age_Products']].head())
